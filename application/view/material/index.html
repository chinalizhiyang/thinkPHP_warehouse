<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©æ–™ç®¡ç† - åº·æ³½ç¯ä¿ä»“å‚¨ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .navbar {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        .navbar-brand {
            font-weight: bold;
            color: #007bff;
        }
        .dropdown-menu {
            min-width: 150px;
        }
        .dropdown-item {
            padding: 0.5rem 1rem;
        }
        .empty {
            text-align: center;
            padding: 20px;
            color: #999;
        }
        .pagination {
            justify-content: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <span style="color: #007bff;">ğŸ­</span> åº·æ³½ç¯ä¿ä»“å‚¨ç®¡ç†ç³»ç»Ÿ
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {foreach $menu as $item}
                    {if isset($item['children']) && !empty($item['children'])}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="{$item['url']}" id="navbarDropdown{$item['name']}" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            {$item['name']}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown{$item['name']}">
                            {foreach $item['children'] as $child}
                            <li><a class="dropdown-item" href="{$child['url']}">{$child['name']}</a></li>
                            {/foreach}
                        </ul>
                    </li>
                    {else}
                    <li class="nav-item">
                        <a class="nav-link" href="{$item['url']}">{$item['name']}</a>
                    </li>
                    {/if}
                    {/foreach}
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="container mt-5">
        <h1>ç‰©æ–™ç®¡ç†</h1>
        <div class="mt-3 mb-3">
            <a href="/material/add" class="btn btn-primary">æ·»åŠ ç‰©æ–™</a>
            <a href="/material/category" class="btn btn-secondary">åˆ†ç±»ç®¡ç†</a>
        </div>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ç‰©æ–™åç§°</th>
                    <th>ç‰©æ–™ç¼–ç </th>
                    <th>åˆ†ç±»</th>
                    <th>å•ä½</th>
                    <th>å•ä»·</th>
                    <th>åº“å­˜</th>
                    <th>æœ€å°åº“å­˜</th>
                    <th>çŠ¶æ€</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {if $materials}
                    {foreach $materials as $material}
                    <tr>
                        <td>{$material.id}</td>
                        <td>{$material.name}</td>
                        <td>{$material.code}</td>
                        <td>{$material.category_name}</td>
                        <td>{$material.unit}</td>
                        <td>{$material.price}</td>
                        <td>{$material.stock}</td>
                        <td>{$material.min_stock}</td>
                        <td>{$material.status ? 'å¯ç”¨' : 'ç¦ç”¨'}</td>
                        <td>
                            <a href="/material/edit/{$material.id}" class="btn btn-sm btn-primary">ç¼–è¾‘</a>
                            <a href="/material/delete/{$material.id}" class="btn btn-sm btn-danger">åˆ é™¤</a>
                        </td>
                    </tr>
                    {/foreach}
                {else}
                    <tr><td colspan="10" class="empty">æš‚æ— ç‰©æ–™è®°å½•</td></tr>
                {/if}
            </tbody>
        </table>
        
        <!-- åˆ†é¡µæ§ä»¶ -->
        {if $total_pages > 1}
        <nav aria-label="åˆ†é¡µ">
            <ul class="pagination">
                <li class="page-item {if $page == 1}disabled{/if}">
                    <a class="page-link" href="/material?page={$page - 1}&page_size={$page_size}" aria-label="ä¸Šä¸€é¡µ">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                
                <!-- æ˜¾ç¤ºç¬¬ä¸€é¡µ -->
                {if $page > 3}
                <li class="page-item">
                    <a class="page-link" href="/material?page=1&page_size={$page_size}">1</a>
                </li>
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
                {/if}
                
                <!-- æ˜¾ç¤ºå½“å‰é¡µé™„è¿‘çš„é¡µç  -->
                {if $total_pages <= 5}
                    <!-- æ€»é¡µæ•°å°äºç­‰äº5ï¼Œæ˜¾ç¤ºæ‰€æœ‰é¡µç  -->
                    {foreach range(1, $total_pages) as $page_num}
                    <li class="page-item {if $page == $page_num}active{/if}">
                        <a class="page-link" href="/material?page={$page_num}&page_size={$page_size}">{$page_num}</a>
                    </li>
                    {/foreach}
                {else}
                    <!-- æ€»é¡µæ•°å¤§äº5ï¼Œæ˜¾ç¤ºå½“å‰é¡µé™„è¿‘çš„é¡µç  -->
                    {if $page <= 3}
                        <!-- å½“å‰é¡µåœ¨å‰é¢ï¼Œæ˜¾ç¤º1-5é¡µ -->
                        {foreach range(1, 5) as $page_num}
                        <li class="page-item {if $page == $page_num}active{/if}">
                            <a class="page-link" href="/material?page={$page_num}&page_size={$page_size}">{$page_num}</a>
                        </li>
                        {/foreach}
                    {elseif $page >= $total_pages - 2}
                        <!-- å½“å‰é¡µåœ¨åé¢ï¼Œæ˜¾ç¤ºæœ€å5é¡µ -->
                        {foreach range($total_pages - 4, $total_pages) as $page_num}
                        <li class="page-item {if $page == $page_num}active{/if}">
                            <a class="page-link" href="/material?page={$page_num}&page_size={$page_size}">{$page_num}</a>
                        </li>
                        {/foreach}
                    {else}
                        <!-- å½“å‰é¡µåœ¨ä¸­é—´ï¼Œæ˜¾ç¤ºå½“å‰é¡µé™„è¿‘çš„5é¡µ -->
                        {foreach range($page - 2, $page + 2) as $page_num}
                        <li class="page-item {if $page == $page_num}active{/if}">
                            <a class="page-link" href="/material?page={$page_num}&page_size={$page_size}">{$page_num}</a>
                        </li>
                        {/foreach}
                    {/if}
                {/if}
                
                <!-- æ˜¾ç¤ºæœ€åä¸€é¡µ -->
                {if $page < $total_pages - 2}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
                <li class="page-item">
                    <a class="page-link" href="/material?page={$total_pages}&page_size={$page_size}">{$total_pages}</a>
                </li>
                {/if}
                
                <li class="page-item {if $page == $total_pages}disabled{/if}">
                    <a class="page-link" href="/material?page={$page + 1}&page_size={$page_size}" aria-label="ä¸‹ä¸€é¡µ">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
        {/if}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
